machine:
  timezone:
    Asia/Tokyo

dependencies:
    override:
        - sudo pip install awscli
    post:
        - aws configure set region ap-northeast-1

test:
  override:
    - echo "All the tests are passed!!"

deployment:
  production: # just a label; label names are completely up to you
    branch: master
    commands:
      - aws s3 sync html/ s3://www.proudit.jp/ --delete
      - sed -i -e "s/REPLACE-DATA-BACKET/pd-form-data/g" html/js/form.js
      - aws s3 sync html/ s3://www.proudit.jp/ --delete
      - cd lambda/ && zip -r lambda.zip ./*
      - aws lambda update-function-code --function-name pd-form --zip-file fileb://./lambda/lambda.zip --publish
  staging:
    branch: staging
    commands:
      - sed -i -e "s/REPLACE-DATA-BACKET/st-pd-form-data/g" html/js/form.js
      - aws s3 sync html/ s3://st.proudit.jp/ --delete
      - cd lambda/ && zip -r lambda.zip ./*
      - aws lambda update-function-code --function-name st-pd-form --zip-file fileb://./lambda/lambda.zip --publish

